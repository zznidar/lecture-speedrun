<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
	<meta name="author" content="Žan Žnidar">
	<title>Lecture Speedrun</title>
	<meta name="description" content="Speed up silent portions of a lecture video/audio on-the-fly!">
	<link rel="stylesheet" type="text/css" href="style.css">
</head> 
<body> 

<div id="benr" style="background-color: hsla(60, 100%, 90%, 1); margin-bottom: 0.5em; text-align: center; padding: 0.3em;"><span style="color: hsla(60, 100%, 25%, 1); padding: 0.3em;">Lecture Speedrun is still in its very experimental prototype stage and may not work in all browsers (probably due to MediaElementAudioSourceNodeCrossOrigin) <a href="https://github.com/zznidar/lecture-speedrun" style="color: hsla(60, 100%, 25%, 1); padding: 0.3em;">Fix the project on <img src="GitHub-Mark-32px.png" alt="GitHub" style="height: 1em">!</a></span></div>


<label for="videoUrl">Video (direct URL):</label> <input type="url" name="videoUrl" id="videoUrl" placeholder="video URL">
<input type="button" value="Set!" onclick="myVideo.src=videoUrl.value"><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">Direct URL to a video usually ends in <i>.mp4, .mov, or a similar extension</i>.</div>

<br><p>or choose a local file:<br>
<label for="myfile">Choose file:</label> <input type="file" accept="video/*, audio/*" id="myfile" name="myfile" onchange="test()"></p>
<br>

<div id="settings">
<label for="threshold">loudness threshold:</label> <input type="number" name="threshold" id="threshold" placeholder="loudness threshold" value="0.1" step="0.01" min=0 max=1><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">How loud the audio should be at a given moment to be treated as speech. Observe <i>Current loudness</i> below to fine-tune it.</div>

<label for="smoothen">Smoothen last <i>n</i> samples:</label> <input type="number" name="smoothen" id="smoothen" placeholder="smoothing" value="10" step="1" min=1><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">How many consequent analyses should be silent to count it as silence</div>

<label for="silentspeed">Speed of silence:</label> <input type="number" name="silentspeed" id="silentspeed" placeholder="Silent speed" value="10" min=0><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">Speed of video when silent</div>

<label for="loudspeed">Speed of speech:</label> <input type="number" name="loudspeed" id="loudspeed" placeholder="Loudness speed" value="1.5" step="0.5" min=0><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">Speed of video when speaking</div>

<label for="lefting">Revert each start of speaking [in seconds] (set 0 to disable lefting):</label> <input type="number" name="lefting" id="lefting" placeholder="lefting [s]" value="0" step="0.1"><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">How much back to jump when speech starts again (to avoid cutting the first letters of speech) [in seconds]. Please note that this may produce unexpected results when watching high-quality videos; in that case just set it to 0 to disable it</div>

<br> <label for="gaining">Additionally gain audio (afterwards):</label> <input type="number" name="gaining" id="gaining" placeholder="Audio gain" value="1" step="0.5" min=0><img src="info6-32px.png" alt="Hover for more info" class="info"><div class="h">Should the input video be too silent for you to hear it properly, use this to additionally increase volume. <i>This does not affect the analysis as it happens after analysing the sound</i></div>

<input type="button" value="Confirm!" onclick="set();">
</div>

<span id="fast" style="visibility:hidden">&#x23e9;&#xfe0e;</span>


<p style="padding-bottom: 0; padding-block-end: 0; margin-bottom: 0; margin-block-end: 0;">Current loudness: <span id="loudness"></span></p>


<video width="100%" height="100%" crossorigin="anonymous" controls >
  <source id="sourchee" src="" crossorigin="anonymous">
Your browser does not support the video tag.
</video>

<script>
function test() {
	sourchee.src = (URL.createObjectURL(myfile.files[0]));
	myVideo.load();
	if(ctx.state === "suspended") ctx.resume(); // Audio context can only be created/resumed on user input
}
</script>


<script src="speedrun.js"></script>

<script>
	console.log("DOM Loaded!");
	passVideo(document.querySelector('video'), document.getElementById("loudness"), document.getElementById("fast")); // Pass the elements
	console.log(begin()); // Begin the Lecture Speedrun analysis

	function set() {
		updateSettings({
			"threshold": threshold.value,
			"silentspeed": silentspeed.value,
			"loudspeed": loudspeed.value,
			"gaining": gaining.value,
			"smoothen": smoothen.value,
			"lefting": lefting.value
		})
	}
</script>
</body> 
</html> 